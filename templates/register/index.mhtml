<%once>
    use JSON::XS;
</%once>
<%args>
    $form
    @users => undef
</%args>

<h1>CFD Trading Club Registration Form</h1>
<p>Registration is <b>FREE</b> so complete the form below to sign up and create an account.</p>

<% $c->flash->{status_msg} %>

<% $form %>

<script>
    // Checks if the username is taken already
    function checkUser() {
        var thisUser = $('#registration-form-username').val();
        $('#registration-form #usercheck .text').removeClass('error');
        $('#usercheck .error_message').addClass('hidden');

        // If the user doesn't exist
        if ($.inArray(thisUser, <% encode_json(\@users) | n %>) == -1) {
            $('#usercheck .check_message').addClass('available');
            $('#usercheck .check_message').html('Available');
        } else {
            $('#usercheck .check_message').html('Not available');
            $('#usercheck .check_message').addClass('error');
            $('#usercheck .check_message').removeClass('available');
        }
    };

    $('#check_availability').click(function() {
        checkUser();
    });
</script>
