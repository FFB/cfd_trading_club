<%args>
    $ticker => "SPX"
</%args>

<div class="predictor">
    <div class="ticker"><% $ticker %><u>?</u></div>
    <div id="<% $ticker %>-price" class="latest-price">
        <p>Latest: 1250.4</p>
    </div>
    <form id="<% $ticker %>-predictor" class="predictor-form">
        <div class="arrow-box">
            <div id="<% $ticker %>-down" class="arrow down-arrow"></div>
            <div id="<% $ticker %>-up"   class="arrow up-arrow"></div>
            <input type="radio" name="<% $ticker %>-estimate" value="up" class="hidden">
            <input type="radio" name="<% $ticker %>-estimate" value="down" class="hidden">
        </div>
        <div class="button-container">
            <input type="button" class="button reset" value="Reset">
            <input type="submit" class="button save" value="Save">
        </div>
        <div class="status-msg smallfont"><p>Saved</p></div>
    </form>
</div>

<script>
{
//    // Updates value of hidden input to be submitted
//    function updateEstimateValue() {
//        if ( $down_arrow.hasClass('selected') ) {
//            $estimate.val("down");
//        }
//        else if ( $up_arrow.hasClass('selected') ) {
//            $estimate.val("up");
//        }
//        else {
//            $estimate.val("none");
//        }
//    }
//
//    // Updates arrow radio buttons and values
//    function updateArrows(clicked, not_clicked) {
//        if ($(clicked).hasClass('selected')) {
//            $(clicked).removeClass('selected');
//        }
//        else {
//            $(not_clicked).removeClass('selected');
//            $(clicked).addClass('selected');
//        }
//        updateEstimateValue();
//    }

var $form;

    function updateArrows(arrow_clicked) {
        $(arrow_clicked).parent().children().removeClass('selected');
        $(arrow_clicked).addClass('selected');
    }

    // ON CLICK of UP ARROW
    $('.up-arrow').click(function() {
        updateArrows(this);
        $(this).parents('form').find('input[value="up"]').attr("checked", true);
        clearStatus(this);
    });

    // ON CLICK of DOWN ARROW
    $('.down-arrow').click(function() {
        updateArrows(this);
        $(this).parents('form').find('input[value="down"]').attr("checked", true);
        clearStatus(this);
    });

    // Resets status message
    function clearStatus(obj) {
        $(obj).parents('form').find('.status-msg p').html('Not saved');
    }

    // RESET BUTTON
    $('input.reset').click(function() {
        $(this).parents('form').find('.arrow').removeClass('selected');
        $(this).parents('form').find('input:radio').attr("checked", false);
        clearStatus(this);
    });

    //// Controls hover shit
    //$(".arrow").hover(
    //    function() {
    //        $(this).addClass("hover");
    //    },
    //    function() {
    //        $(this).removeClass("hover");
    //    }
    //);

    // ON SUBMIT
    $('.predictor-form').submit(function() {
        var $status_msg = $(this).find('.status-msg p');
        $status_msg.html('saving');
        $.ajax({
            type:       'POST',
            url:        '<% $c->uri_for('ajax') %>',
            dataType:   'json',
            cache:      false,
            data:       {
                'ticker'     : '<% $ticker %>',
            },
            success: function(json) {
                console.log('ajax success');
                $status_msg.html(json.status_msg);
            }
        });
        return false;
    });
}
</script>
